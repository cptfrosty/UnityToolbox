# Компонент Particle System

## Что такое Particle System
**Particle System (Система Частиц) в Unity** — это инструмент для создания и управления большим количеством мелких объектов (частиц) с целью моделирования сложных визуальных эффектов, которые было бы трудно или невозможно сделать вручную.

## Как это работает?
Вместо того чтобы создавать и анимировать каждый объект по отдельности (например, каждую искру в фейерверке), вы настраиваете один компонент Particle System. Этот компонент определяет правила, по которым появляються, живут и исчезают частицы.

Одна частица — это обычно простой 2D-квид (quad) с текстурой, но благодаря их огромному количеству и правилам движения они создают сложные и органичные эффекты.

## Ключевые компоненты и понятия
Один модуль Particle System состоит из двух основных частей:
1. Компонент Particle System: прикрепляется к GameObject. Содержит все настройки и модули.
2. Particle System Renderer: определяет, как частицы отображаются на экране (какая используется текстура, материал, выравнивание по камере и т.д.).

Сам компонент Particle System разделен на множество модулей. Вот самые важные из них:
- Main (Главный модуль): содержит основные параметры, такие как длительность системы, количество циклов, скорость начала воспроизведения, начальные размер, скорость и время жизни частиц.
- Emission (Излучение): контролирует, как и с какой скоростью частицы появляются (например, постоянный поток или единовременный выброс).
- Shape (Форма): определяет откуда появляются частицы. Это может быть конус, сфера, меш, ребро и др. Форма влияет на вид эффекта.
- Velocity over Lifetime (Скорость за всё время жизни): позволяет контролировать скорость частицы на протяжении всей ее жизни.
- Color over Lifetime (Цвет за всё время жизни): частица может менять цвет от рождения до смерти (например, от желтого к красному и прозрачному для имитации огня).
- Size over Lifetime (Размер за всё время жизни): частица может увеличиваться или уменьшаться со временем.
- Rotation over Lifetime (Вращение за время жизни): задает вращение частиц.
- External Forces (Внешние силы): позволяет ветру из компонента Wind Zone влиять на частицы.
- Collision (Столкновение): делает частицы способными сталкиваться с объектами на сцене (например, капли дождя, падающие на землю).
- Sub Emitters (Дочерние эмиттеры): позволяют создавать цепочки эффектов. Например, при столкновении с землей частица дождя может породить новую систему частиц — брызги.

## Примеры эффектов, создаваемых с помощью Particle System:
- Огонь, дым, пар
- Взрывы
- Фонтаны, водопады, брызги
- Дождь, снег, метель
- Звездные скопления, магические заклинания
- Следы от пуль, кровь
- Стаи птиц или насекомых
- Пыль, выбиваемая из-под ног персонажа
- Эффекты UI (например, конфетти)

## Описание свойств
| Свойство | Назначение |
|:------------|:----------|
| **Duration** | Продолжительность работы системы |
| **Looping** | Если этот параметр включен, система снова запустится по истечении установленного времени и продолжит повторять цикл. |
| **Prewarm** | Если этот параметр включен, система инициализируется так, как если бы она уже завершила полный цикл (работает только в том случае, если также включен цикл) |
| **Start Delay** | Задержка в секундах до того, как система начнет работать после включения. |
| **Start Lifetime** | Начальное время жизни частиц |
| **Start Speed** | Начальная скорость каждой частицы в соответствующем направлении. |
| **3D Start Size** | Размер частиц в 3D пространстве (XYZ) |
| **Start Size** | Начальный размер каждой частицы |
| **3D Start Rotation** | Включите это, если вы хотите управлять вращением каждой оси отдельно. |
| **Start Rotation** | Начальный угол поворота каждой частицы. |
| **Flip Rotation** | Заставляет некоторые частицы вращаться в противоположном направлении. |
| **Start Color** | Начальный цвет каждой частицы. |
| **Gravity Modifier** | Изменяет значение силы тяжести, установленное в окне "Физика". Нулевое значение отключает гравитацию. |
| **Simulation Space** | Определяет, будут ли анимированы частицы в локальном пространстве родительского объекта (следовательно, перемещаясь вместе с родительским объектом), в мировом пространстве или относительно пользовательского объекта (перемещаясь с пользовательским объектом по вашему выбору). |
| **Simulation Speed** | Скорость обновления всей системы. |
| **Delta Time** | Выберите между Scaled и Unscaled, где Scaled использует значение масштаба времени во временном окне, а Unscaled игнорирует его. Это полезно, например, для систем с частицами, которые отображаются в меню паузы. |
| **Scaling Mode** | Выберите, как использовать масштаб в преобразовании. Установите значение Иерархия, Локальный или Форма. Локальный применяет только масштаб преобразования системы частиц, игнорируя любые родительские элементы. Режим формы применяет масштаб к начальным позициям частиц, но не влияет на их размер. |
| **Play on Awake** | Если этот параметр включен, система частиц запускается автоматически при создании объекта. |
| **Emitter Velocity** | Выберите, как система частиц рассчитывает скорость, используемую модулями Inherit Velocity и Emission. Система может рассчитать скорость, используя компонент твердого тела, если таковой существует, или отслеживая перемещение компонента преобразования. Если компонент Rigidbody отсутствует, система по умолчанию использует свой компонент Transform. |
| **Max Particles** | Максимальное количество частиц в системе за один раз. При достижении этого предела некоторые частицы удаляются. |
| **Auto Random Seed** | Если этот параметр включен, система частиц выглядит по-разному при каждом воспроизведении. Если установлено значение false, система остается точно такой же при каждом воспроизведении. |
| **Random Seed** | При отключении автоматической выборки случайным образом это значение используется для создания уникального повторяемого эффекта. |
| **Stop Action** | Когда все частицы, принадлежащие системе, завершат работу, можно заставить систему выполнить какое-либо действие. Система считается остановленной, когда все ее частицы умерли, а ее возраст превысил допустимый срок действия. Для циклических систем это происходит только в том случае, если система остановлена с помощью сценария. |
| Disable | Игровой объект отключен. |
| Destroy | Игровой объект удалён. |
| Callback | Обратный вызов OnParticleSystemStopped отправляется всем скриптам, прикрепленным к игровому объекту. |
| **Culling Mode** | Выберите, следует ли приостанавливать моделирование системы частиц, когда частицы находятся за кадром. Наиболее эффективен отбор частиц за кадром, но вы можете продолжить моделирование для получения дополнительных эффектов. |
| Automatic | Циклические системы используют паузу, а все остальные системы всегда используют симуляцию. |
| Pause And Catch-up | Система прекращает симуляцию за кадром. При повторном входе в режим просмотра симуляция выполняет большой шаг, чтобы достичь точки, в которой она находилась бы, если бы не была приостановлена. В сложных системах этот параметр может привести к скачкам производительности. |
| Pause | Система прекращает имитацию, находясь за кадром. |
| Always Simulate | Система обрабатывает имитацию каждого кадра, независимо от того, отображается он на экране или нет. Это может быть полезно для создания одноразовых эффектов, таких как фейерверк, которые во время имитации будут очевидны. |
| **Ring Buffer Mode** | Сохраняет жизнеспособность частиц до тех пор, пока они не достигнут максимального количества частиц, после чего новые частицы перерабатывают самые старые, вместо того чтобы удалять частицы по истечении срока их службы. |
| Disabled | Отключите режим кольцевого буфера, чтобы система удаляла частицы по истечении срока их службы. |
| Pause Until Replaced | В конце срока службы старых частиц они приостанавливаются до тех пор, пока не будет достигнуто максимальное количество частиц, после чего система повторно использует их, чтобы они снова появлялись в виде новых частиц. |
| Loop Until Replaced | По истечении срока службы частицы отматываются назад до заданной доли срока службы, пока не будет достигнут максимальный предел содержания частиц, после чего система перерабатывает их, и они вновь появляются в виде новых частиц. |

## Emission

| Свойство | Назначение |
|:------------|:----------|
| **Rate over Time** | Определяет, сколько частиц рождается в секунду, пока система активна. |
| **Rate over Distance** | Определяет, сколько частиц рождается на единицу расстояния, которое перемещается эмиттер (объект, на котором висит система частиц) (Для движущихся объектов) |
| **Bursts** | Позволяет запланировать мгновенные выбросы определенного количества частиц в заданный момент времени. Это не постепенный поток, а единовременный "залп". |
| _Time_ |  Момент, когда произойдет выброс, в секундах от начала цикла системы. |
| _Count_ | Сколько частиц будет выброшено. Можно задать константу, случайное значение между двумя константами или кривую |
| _Cycles_ | Сколько раз повторить этот выброс. По умолчанию 1 (один раз). |
| _Interval_ | Если Cycles больше 1, это поле определяет паузу (в секундах) между повторяющимися выбросами. |
| _Probability_ | Шанс, что выброс вообще произойдет. 1.0 = 100% шанс, 0.5 = 50% шанс. |

## Shape
| Свойство | Назначение |
|:------------|:----------|
| **Shape** | Выбор геометрической формы эмиттера. |
| **Radius** | Основной радиус. |
| **Position / Rotation / Scale** | Позволяют смещать, поворачивать и масштабировать саму форму эмиттера относительно GameObject, на котором висит система частиц. Это не влияет на трансформ самого GameObject. |
